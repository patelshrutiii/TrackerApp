
@{
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
}
<head>
    <title>Tasks</title>
    <link href="~/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <link href="~/plugins/clockpicker/css/bootstrap-clockpicker.min.css" rel="stylesheet">
    <link href="~/CSS/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="~/CSS/icons.css" rel="stylesheet" type="text/css" />
    <link href="~/CSS/style.css" rel="stylesheet" type="text/css" />
    <script src="~/js/modernizr.min.js"></script>
    <script src="~/Scripts/jquery-3.4.1.min.js"></script>

    <style>
        .project-Active {
            /* background-color: #0099cc !important;
            color: white;*/
            background-color: #7E57C2 !important;
            color: white;
        }

        .AddTask {
            padding: 10px 10px 10px 10px;
            font-size: 20px;
            border: none;
            max-width: 100%;
        }

        .AddTaskDiv {
            padding: 5px 5px 5px 5px;
        }

        tr #ProjectColor:focus {
            background-color: blue;
        }

        .AddSymbol {
            float: right;
            font-size: 30px;
            margin-top: -31px;
        }

        .plus {
            border: none;
            color: grey;
            background: none;
            font-size: 15px;
            cursor: pointer;
        }

        .spanrounded {
            border-radius: 2em !important;
            padding: 3px 5px;
            cursor: auto !important;
            background: #e3e3e3;
            color: #727171;
            margin-right: 4px;
            /*white-space: nowrap;*/
        }

        .DeleteUser {
            padding: 0px 0px 0px 5px;
            cursor: pointer;
        }

        .abc:focus {
            background: blue;
        }

        .abc {
            background: white;
            padding: 3px 0px 3px 10px;
            text-transform: uppercase;
            border: 1px solid #fffffd08;
        }
        .Complete td {
            /* background: #e3e3e3 !important;*/
            background: #e2daf1 !important;
        }

        .urgent td {
        }

        tr .fa {
            color: forestgreen;
            font-size:16px;
        }
        .button-clicked {
            background: red;
        }

        .panel-heading {
            padding: 10px 15px;
            border-bottom: 1px solid transparent;
            border-top-right-radius: 2px;
            border-top-left-radius: 2px;
        }

        .project .pull-right {
            margin-right: -10px !important;
        }

        .pull-right {
            float: right !important;
        }

        .projectpanel {
            margin-bottom: 5px;
            background-color: #fff;
            border-radius: 3px;
            -webkit-box-shadow: 0 1px 1px rgb(0 0 0 / 5%);
            box-shadow: 0 1px 1px rgb(0 0 0 / 5%);
        }

        .icon:after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            margin: auto;
            background-size: 100% !important;
        }

        .project-name {
            max-width: 205px;
        }

        .projectpanel:hover {
            transition: all .2s;
            background-color: #7E57C2 !important;
            color: white;
            transition: all .2s;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
        }

        .project i.icon-left {
            -webkit-transform: rotate( 180deg) !important;
            -moz-transform: rotate(180deg) !important;
            -ms-transform: rotate(180deg) !important;
            -o-transform: rotate(180deg) !important;
            transform: rotate( 180deg) !important;
            margin: 0 18px 0 0 !important;
            opacity: 1;
        }

        .icon {
            position: relative;
            display: inline-block;
            vertical-align: middle;
            width: 17px;
            height: 20px;
            font-size: 23px;
        }

        /*  ToolTip CSS  */
        .tool {
            cursor: help;
            position: relative;
        }

            .tool::before,
            .tool::after {
                left: 50%;
                opacity: 0;
                position: absolute;
                z-index: -100;
            }

            .tool:hover::before,
            .tool:focus::before,
            .tool:hover::after,
            .tool:focus::after {
                opacity: 1;
                transform: scale(1) translateY(0);
                z-index: 100;
            }

            .tool::before {
                border-style: solid;
                border-width: 1em 0.75em 0 0.75em;
                border-color: #3E474F transparent transparent transparent;
                bottom: 100%;
                content: "";
                margin-left: -0.5em;
                transition: all .65s cubic-bezier(.84,-0.18,.31,1.26), opacity .65s .5s;
                transform: scale(.6) translateY(-90%);
            }

            .tool:hover::before,
            .tool:focus::before {
                transition: all .65s cubic-bezier(.84,-0.18,.31,1.26) .2s;
            }


            .tool::after {
                background: #46899a;
                border-radius: .25em;
                bottom: 180%;
                color: #EDEFF0;
                content: attr(data-tip);
                margin-left: -4.75em;
                /*padding-left: 1em;*/
                transition: all .65s cubic-bezier(.84,-0.18,.31,1.26) .2s;
                transform: scale(.6) translateY(50%);
                width: 9.5em;
                height: 25px;
            }

            .tool:hover::after,
            .tool:focus::after {
                transition: all .65s cubic-bezier(.84,-0.18,.31,1.26);
            }
        .ellips {
            max-width: 500px;          
            padding: 5px;
            word-wrap: break-word;
            text-overflow: ellipsis;
        }
       /* .checked {
            checked
        }
*/
        .strikethrough {
            text-decoration: line-through !important;
        }
        @@media (max-width: 760px) {
            .tool::after {
                font-size: .75em;
                margin-left: -5em;
                width: 10em;
            }
        }

        .tool1 {
            cursor: help;
            position: relative;
        }

            .tool1::before,
            .tool1::after {
                left: 50%;
                opacity: 0;
                position: absolute;
                z-index: -100;
            }

            .tool1hover::before,
            .tool1:focus::before,
            .tool1:hover::after,
            .tool1:focus::after {
                opacity: 1;
                transform: scale(1) translateY(0);
                z-index: 100;
            }

            .tool1::before {
                border-style: solid;
                border-width: 1em 0.75em 0 0.75em;
                border-color: #3E474F transparent transparent transparent;
                bottom: 120%;
                content: "";
                /*margin-left: -0.5em;*/
                transition: all .65s cubic-bezier(.84,-0.18,.31,1.26), opacity .65s .5s;
                transform: scale(.6) translateY(-90%);
            }

            .tool1:hover::before,
            .tool1:focus::before {
                transition: all .65s cubic-bezier(.84,-0.18,.31,1.26) .2s;
            }


            .tool1::after {
                background: black;
                border-radius: .25em;
                bottom: 100%;
                color: #EDEFF0;
                content: attr(data-tip);
                margin-left: -1.75em;
                /*padding-left: 1em;*/
                transition: all .65s cubic-bezier(.84,-0.18,.31,1.26) .2s;
                transform: scale(.6) translateY(50%);
                width: 4.75em;
                height: 25px;
            }

            .tool1:hover::after,
            .tool1:focus::after {
                transition: all .65s cubic-bezier(.84,-0.18,.31,1.26);
            }

        @@media (max-width: 760px) {
            .tool1::after {
                font-size: .75em;
                margin-left: -5em;
                width: 10em;
            }
        }


    </style>
</head>
<body>

    <br />
    <div ng-controller="TaskController" class="divList">

        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <div style="margin-top:50px">                                        
                    <div class="col-xs-12">
                        <div class="form-group">
                            <input type="text" placeholder="Search By Task" class="form-control w-75 text-center"  ng-model="search" style="border: none; height: 40px; font-size: 16px;" />
                        </div>
                    </div>
                        <div class="col-xs-12"><h2>Projects</h2></div>
                        <br />
                        <div class="col-xs-12">
                            <div id="ProjectColor" class="project" ng-repeat="p in projects">
                                <div class="projectpanel projecttab" id="projecttab-{{p.ProjectId}}" ng-click="GetTaskByProject(p.ProjectId); ProjectsTab(p.ProjectId);GetProjectname()" ng-class="{ 'project-Active':$index==0}">
                                    <div class="panel-heading project-handle" style="cursor:pointer;">
                                        <div class="pull-right ">
                                            <i class="fa fa-angle-double-left icon icon-left"></i>
                                        </div>
                                        <span class="project-name">{{p.ProjectName}}</span>
                                    </div>
                                </div>
                            </div>
                            <table style="width:100%;border-collapse: separate;border-spacing: 0 7px;">
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-lg-8">

                    @*List*@
                    <div style="margin-top:50px">
                        <div class="row">
                            <div class="col-md-8">
                                <ul class="nav nav-tabs tabs tabs-top">
                                    <li class="Active tab">
                                        <a href="#messages-21" data-toggle="tab" aria-expanded="true" id="alltask" ng-click="TaskFilter('GetAll')">
                                            All Tasks
                                        </a>
                                    </li>
                                    <li class="tab">
                                        <a href="#settings-21" data-toggle="tab" aria-expanded="false" ng-click="TaskFilter('Active')">
                                            Active Tasks
                                        </a>
                                    </li>
                                    <li class="tab">
                                        <a href="#radhs-21" data-toggle="tab" aria-expanded="false" ng-click="TaskFilter('Completed')">
                                            Completed Tasks
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-2"></div>
                            <div class="col-md-2">
                                <i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" title="Delete All Tasks"  ng-click="DeleteAllTask()" aria-hidden="true" style="font-size: 25px;color: mediumvioletred;cursor:pointer;"></i>
                                <i class="fa fa-calendar-check-o " data-toggle="tooltip" data-placement="top" title="Delete Completed Tasks" data-tip="Delete Completed tasks" ng-click="DeleteCompletedTask()" aria-hidden="true" style="font-size: 25px;color: mediumvioletred;cursor:pointer"></i>

                            </div>
                        </div>
                        <div class="row" ng-repeat="pname in pnames">
                            <div class="col-9 align-self-center"><h2><label>Tasks : {{pname.ProjectName}}</label></h2></div>
                            <div class="col-3 pt-2">
                                <button type="submit" style="background-color:#7FBA00;color:#FFFFFF;height:40px;font-size:18px;" class="form-control btn w-lg " id="btnAdd" onclick="AddTask()">
                                    <i class="fa fa-plus-circle"></i>
                                    &nbsp; <span>Add Task</span>
                                </button>
                            </div>
                        </div>
                        <br />
                        <div class="row" ng-show="isshowtable == true">
                            <div class="col-12">
                                <div id="ShowTask" style="display: none" class="AddTaskDiv">
                                    <input type="text" id="taskinsert" ng-model="Task.TaskName" @*(keyup.enter)="Create(Task)"*@ ng-keyup="$event.keyCode == 13 ? Create(Task) : null" @*ng-enter="Create(Task)"*@ class="form-control AddTask" placeholder="+ Some text value..." name="Tname" />
                                </div>

                                <div class="table-responsive" style="max-height:300px;">
                                    <table class="table table-actions-bar mb-0">
                                        <tbody>
                                            <tr class="Active" ng-repeat="ta in tasks | filter:search" ng-class="{'Complete':(ta.StatusName | lowercase)  == 'done'}" ng-model="search">
                                                @*<td>
            <input type="checkbox" ng-model="ta.IsDeleted" ng-click="UpdateStatus(ta.TaskId)" />
        </td>*@
                                                <td>
                                                    <i ng-class="{'fa fa-check':(ta.StatusName | lowercase)  == 'done'}"></i>
                                                </td>
                                                <td>
                                                    <i ng-class="{'ti-import':ta.IsDeleted}" ng-click="UpdateStatus(ta.TaskId)" style="cursor:pointer;"></i>

                                                </td>
                                                <td>
                                                    <div class="ellips" ng-class="{'strikethrough' :ta.IsDeleted}">
                                                        {{ta.TaskName| strLimit:60}}
                                                    </div>

                                                    <span class="spanrounded" ng-repeat="aa in ta.userassign">
                                                        <span> {{aa.FirstName + ' ' +(aa.LastName | truncate:true:1:'.') }}</span>

                                                        <i class="fa fa-times DeleteUser" style="color:slategray;" ng-click="DeleteUser(aa.TaskAssignId)"></i>
                                                    </span>
                                                </td>

                                                <td>
                                                    <select ng-model="ta.UserId"
                                                            ng-focus="GetTaskAssignedUsers(ta.TaskId)"
                                                            @*ng-change="TaskAssignUser(ta)"*@ class="btn btn-white btn-sm dropdown-toggle waves-effect waves-light"
                                                            @*ng-options="uObj.UserId as uObj.FirstName + ' ' + uObj.LastName for uObj in users"*@
                                                            ng-change="TaskAssign(ta.UserId,ta)">
                                                        <option value="">select User</option>
                                                        <option value="AssignToAll">Assign To All</option>
                                                        <option value="{{uObj.UserId}}" ng-repeat="uObj in users">{{uObj.FirstName + ' ' + uObj.LastName}}</option>
                                                    </select>

                                                </td>
                                                <td>
                                                    <span class="label label-danger" ng-show="ta.PriorityName == 'Urgent'">
                                                        Urgent
                                                    </span>
                                                </td>
                                                <td>
                                                    <a class="table-action-btn" style="display: inline-block;cursor:pointer" data-tip="Edit" ng-click="Edit(ta)"><i class="md md-edit" style="color:cadetblue;font-size:20px;"></i></a>
                                                    <a class="table-action-btn" style="display: inline-block;cursor:pointer" data-tip="Delete" ng-click="Delete(ta.TaskId)"><i class="fa fa-close block-all" style="color:indianred;font-size:20px;"></i></a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>
                    </div>

                    @*Edit*@
                    <div class="card-box" ng-show="isshowtable == false">
                        <div class="row">
                            <div class="col-10"></div>
                            <div class="col-2">
                                <button type="submit" class="btn btn-danger" id="btnClose" ng-click="Close()">Close</button>
                            </div>
                        </div>
                        <hr />
                        <form class="form-horizontal" role="form" name="f2" novalidate>
                            <div class="row">
                                <div class="col-12">
                                    <div class="p-20">
                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Title</label>
                                            <div class="col-10">
                                                <input type="text" class="form-control" ng-model="Task.TaskName" name="title" required>
                                                <p style="color:red;" ng-show="(f2.title.$touched || f2.title.$dirty)">
                                                    <p style="color:red;" ng-show="f2.title.$error.required">Title is required</p>
                                                </p>
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Assignees</label>
                                            <div class="col-10">
                                                <span class="spanrounded" ng-repeat="ta in Task.userassign">
                                                    <span> {{ta.FirstName + ' ' +(ta.LastName | truncate:true:1:'.') }}</span>

                                                    <i class="fa fa-times DeleteUser" ng-click="DeleteUser(ta.TaskAssignId)"></i>
                                                </span>

                                                <select ng-model="Task.UserId"
                                                        ng-focus="GetTaskAssignedUsers(Task.TaskId)"
                                                        class="btn btn-white btn-sm dropdown-toggle waves-effect waves-light"
                                                        ng-change="TaskAssign(Task.UserId,Task)">
                                                    <option value="">select User</option>
                                                    <option value="AssignToAll">Assign To All</option>
                                                    <option value="{{uObj.UserId}}" ng-repeat="uObj in users">{{uObj.FirstName + ' ' + uObj.LastName}}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <div class="col-sm-6">
                                                <label class="col-xs-4 col-form-label">Start Date</label>
                                                <div class="col-xs-8 input-group">
                                                    <input type="text" class="form-control" ng-model="Task.StartDate" id="datepicker-autoclose" name="start" required>
                                                    <p style="color:red;" ng-show="(f2.start.$touched || f2.start.$dirty)">
                                                        <p style="color:red;" ng-show="f2.start.$error.required">Start Date is required</p>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <label class="col-xs-4 col-form-label">DeadLine</label>
                                                <div class="input-group col-xs-8">
                                                    <input type="text" class="form-control" ng-model="Task.Deadline" id="datepicker" name="deadline" required>
                                                    <p style="color:red;" ng-show="(f2.deadline.$touched || f2.deadline.$dirty)">
                                                        <p style="color:red;" ng-show="f2.deadline.$error.required">DeadLine is required</p>
                                                    </p>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-sm-6">
                                            <label class="col-xs-6 col-form-label">Priority</label>
                                            <div class="col-xs-6">
                                                <select ng-model="Task.PriorityId" name="priority" @*ng-click="GetTaskAssignedUsers()"*@ class="btn btn-white btn-sm dropdown-toggle waves-effect waves-light" ng-options="piObj.PriorityId as piObj.PriorityName for piObj in Priorities">
                                                    @*<option value="" selected ng-model="Task.PriorityName"></option>*@
                                                </select>                                             
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <label class="col-xs-6 col-form-label">Status</label>
                                            <div class="col-xs-6">
                                                <select ng-model="Task.StatusId" name="status" @*ng-click="GetTaskAssignedUsers()"*@ class="btn btn-white btn-sm dropdown-toggle waves-effect waves-light" ng-options="stObj.StatusId as stObj.StatusName for stObj in statuses">
                                                    @*<option value="" selected ng-model="Task.PriorityName"></option>*@
                                                </select>                                              
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-2 col-form-label">Notes</label>
                                        <div class="col-10">
                                            <textarea class="form-control" rows="5" ng-model="Task.TaskNotes" name="notes"></textarea>                                           
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <button class="btn btn-primary waves-effect waves-light" type="submit" ng-click="Create(Task)" ng-disabled="f2.$invalid">
                                            Submit
                                        </button>
                                    </div>
                                </div>
                            </div>

                       </form>
                    </div>

                </div>

            </div>

        </div>
        @Html.Hidden("taskId")

    </div>

  <script type="text/javascript">

        $("#button").click(function () {
            $("#button").addClass('button-clicked');
        });
        function AddTask() {
            var x = document.getElementById("ShowTask");
            if (x.style.display === "none") {
                x.style.display = "block";
            }
        }

        function ShowProjectNameCol() {
            var x = document.getElementById("myDIV");
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        });

    </script>

</body>
@section script {
    <script src="~/Scripts/Services/TaskService.js"></script>
    <script src="~/Scripts/Services/ProjectService.js"></script>
    <script src="~/Scripts/AngularController/TaskCtrl.js"></script>

    <script src="~/plugins/moment/moment.js"></script>
    <script src="~/plugins/timepicker/bootstrap-timepicker.js"></script>
    <script src="~/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
    <script src="~/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="~/plugins/clockpicker/js/bootstrap-clockpicker.min.js"></script>
    <script src="~/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
    <script src="~/pages/jquery.form-pickers.init.js"></script>
}



